/*!
 * jquery.wm-zoom - v 1.0
 * desenvolvido por Welison Menezes
 * email : welisonmenezes@gmail.com
 * 
 *
 * Copyright 2014 Welison Menezes
 * @license http://www.opensource.org/licenses/mit-license.html MIT License
 * @license http://www.gnu.org/licenses/gpl.html GPL2 License 
 */
!function(t){"use strict";t.fn.extend({WMZoom:function(i){var o={config:{stageW:500,stageH:400,inner:!1,position:"right",margin:10}},i=t.extend(!0,o,i);return this.each(function(){var o,n=t(this),e=n.find(".wm-zoom-box"),s=e.find("img"),f=s.attr("data-loader-src"),p=t("<div />").addClass("wm-zoom-lens"),a=t("<div />").addClass("wm-zoom-hight"),c=t("<img />").addClass("wm-zoom-loader").attr("src",f);e.append(p),a.html(c),e.prepend(a);var g,h,d,r,m,l,x,u,w,v,z,C,I,M,W,b,H,O,j,y,Q,T,X,Y,Z,k,q,A=function(){g=s.width(),h=s.height(),d=n.offset(),i.config.inner===!0?(k=g,q=h):(k=i.config.stageW,q=i.config.stageH),e.css({height:h+"px",width:g+"px"}),a.css({height:q+"px",width:k+"px"}),i.config.inner===!0?a.css({top:"0px",left:"0px"}):("right"===i.config.position&&a.css({top:"0px",left:g+i.config.margin+"px"}),"bottom"===i.config.position&&a.css({top:h+i.config.margin+"px",left:"0px"}),"top"===i.config.position&&a.css({top:"-"+(q+i.config.margin)+"px",left:"0px"}),"left"===i.config.position&&a.css({top:"0px",left:"-"+(k+i.config.margin)+"px"}))},B=function(){l=c.width(),x=c.height(),u=k/2-l/2,w=q/2-x/2,c.css({top:w+"px",left:u+"px"})},D=function(){if(o.length<1){var i=s.attr("data-hight-src");if(0==r){r=!0,m=!1;var n=new Image;t(n).addClass("wm-zoom-hight-img").attr("src",i).load(function(){o.remove(),a.append(n),m=!0})}}else r=!0,m=!0},E=function(){A(),r=!1,m=!1,e.mouseenter(function(){i.config.inner!==!0&&p.stop().fadeIn(300),a.stop().fadeIn(300),B()}).mousemove(function(i){t(this);return o=a.find("img.wm-zoom-hight-img"),D(),1!=m&&1!=r?!1:(v=a.width(),z=a.height(),C=o.width(),I=o.height(),M=k*g/C,W=q*h/I,b=M/2,H=W/2,W>h&&(W=h),M>g&&(M=g),p.css({width:M,height:W}),O=i.pageX-d.left,j=i.pageY-d.top,(O>g||0>O||j>h||0>j)&&(p.hide(),a.hide()),y=O-b,0>y?y=0:y>g-M&&(y=g-M),Q=j-H,0>Q?Q=0:Q>h-W&&(Q=h-W),p.css({left:y+"px",top:Q+"px"}),T=(C-v/2)/(g-b),X=Math.ceil(T*y),X>C-v&&(X=C-v),Y=(I-z/2)/(h-H),Z=Math.ceil(Y*Q),Z>I-z&&(Z=I-z),void o.css({left:"-"+X+"px",top:"-"+Z+"px"}))}).mouseleave(function(){p.stop().fadeOut(300),a.stop().fadeOut(300)})};setTimeout(function(){E()},10)})}})}(jQuery);